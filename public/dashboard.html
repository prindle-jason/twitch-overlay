<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Overlay Dashboard</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        padding: 1rem;
        max-width: 600px;
        margin: 0 auto;
      }
      h1 {
        margin-top: 0;
      }
      .info {
        background: #f0f0f0;
        padding: 1rem;
        border-radius: 4px;
      }
      button {
        padding: 0.5rem 1rem;
        margin-top: 1rem;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <h1>Overlay Dashboard</h1>
    <div class="info">
      <p>Connected: <strong id="status">Connecting...</strong></p>
    </div>
    <button id="testBtn">Send Test Event</button>
    <button id="statsBtn">Get Stats</button>
    <button id="bamSuccessBtn">Spawn Bam Success</button>
    <div
      id="log"
      style="
        margin-top: 1rem;
        white-space: pre-wrap;
        background: #fafafa;
        padding: 0.5rem;
        border-radius: 4px;
        font-size: 0.85rem;
        font-family: monospace;
        max-height: 300px;
        overflow-y: auto;
      "
    ></div>
    <script>
      const statusEl = document.getElementById("status");
      const logEl = document.getElementById("log");
      const testBtn = document.getElementById("testBtn");
      const statsBtn = document.getElementById("statsBtn");
      const bamSuccessBtn = document.getElementById("bamSuccessBtn");

      function log(msg) {
        logEl.textContent += new Date().toLocaleTimeString() + " " + msg + "\n";
        logEl.scrollTop = logEl.scrollHeight;
      }

      const ws = new WebSocket("ws://" + window.location.host + "/overlay-ws");
      ws.onopen = () => {
        statusEl.textContent = "Connected";
        statusEl.style.color = "green";
        ws.send(JSON.stringify({ type: "hello", role: "dashboard" }));
        log("WS connected");
      };
      ws.onmessage = (e) => {
        try {
          const msg = JSON.parse(e.data);
          log("Received: " + msg.type);
        } catch (err) {
          log("Parse error: " + err.message);
        }
      };
      ws.onclose = () => {
        statusEl.textContent = "Disconnected";
        statusEl.style.color = "red";
        log("WS closed");
      };
      ws.onerror = (err) => {
        log("WS error");
      };

      testBtn.addEventListener("click", () => {
        ws.send(JSON.stringify({ type: "ping" }));
      });

      statsBtn.addEventListener("click", () => {
        ws.send(JSON.stringify({ type: "get-stats" }));
      });

      bamSuccessBtn.addEventListener("click", () => {
        ws.send(
          JSON.stringify({
            type: "spawn-effect",
            payload: { effectType: "bamSuccess" },
          })
        );
      });
    </script>
  </body>
</html>
